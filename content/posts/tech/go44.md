---
title: "Goè®¾è®¡æ¨¡å¼-iocä¾èµ–æ³¨å…¥digå’Œwire" #æ ‡é¢˜
date: 2024-03-05T17:09:32+08:00 #åˆ›å»ºæ—¶é—´
lastmod: 2024-03-05T17:09:32+08:00 #æ›´æ–°æ—¶é—´
author: ["citybear"] #ä½œè€…
categories: # æ²¡æœ‰åˆ†ç±»ç•Œé¢å¯ä»¥ä¸å¡«å†™
- tech
tags: # æ ‡ç­¾
- goè®¾è®¡æ¨¡å¼
- goåŒ…
keywords: 
- 
description: "" #æè¿° æ¯ä¸ªæ–‡ç« å†…å®¹å‰é¢çš„å±•ç¤ºæè¿°
weight: # è¾“å…¥1å¯ä»¥é¡¶ç½®æ–‡ç« ï¼Œç”¨æ¥ç»™æ–‡ç« å±•ç¤ºæ’åºï¼Œä¸å¡«å°±é»˜è®¤æŒ‰æ—¶é—´æ’åº
slug: ""
draft: false # æ˜¯å¦ä¸ºè‰ç¨¿
comments: true #æ˜¯å¦å±•ç¤ºè¯„è®º æœ‰è‡ªå¸¦çš„æ‰©å±•æˆtwikoo
showToc: true # æ˜¾ç¤ºç›®å½• æ–‡ç« ä¾§è¾¹æ tocç›®å½•
TocOpen: true # è‡ªåŠ¨å±•å¼€ç›®å½•
hidemeta: false # æ˜¯å¦éšè—æ–‡ç« çš„å…ƒä¿¡æ¯ï¼Œå¦‚å‘å¸ƒæ—¥æœŸã€ä½œè€…ç­‰
disableShare: true # åº•éƒ¨ä¸æ˜¾ç¤ºåˆ†äº«æ 
showbreadcrumbs: true #é¡¶éƒ¨æ˜¾ç¤ºå½“å‰è·¯å¾„
cover:
    image: "" #å›¾ç‰‡è·¯å¾„ï¼šposts/tech/æ–‡ç« 1/picture.png
    caption: "" #å›¾ç‰‡åº•éƒ¨æè¿°
    alt: ""
    relative: false

# reward: true # æ‰“èµ
mermaid: true #è‡ªå·±åŠ çš„æ˜¯å¦å¼€å¯mermaid
---

- [digæ¡†æ¶](https://darjun.github.io/2020/02/22/godailylib/dig/), <font color="red">Digæ˜¯ä¸€ä¸ªç®€å•çš„ä¾èµ–æ³¨å…¥åº“ï¼Œé€‚ç”¨äºå°å‹é¡¹ç›®æˆ–éœ€è¦æ›´çµæ´»æ§åˆ¶ä¾èµ–æ³¨å…¥çš„åœºæ™¯ã€‚</font>
- [wireä»£ç ç”Ÿæˆå™¨](https://darjun.github.io/2020/03/02/godailylib/wire/), æ˜¯ä¸€ä¸ªæ›´åŠ å¼ºå¤§å’Œå…¨é¢çš„IOCæ¡†æ¶ï¼Œæä¾›äº†æ›´å¤šåŠŸèƒ½å’Œç‰¹æ€§ï¼Œ**é€‚ç”¨äºå¤§å‹é¡¹ç›®å’Œå¤æ‚çš„ä¾èµ–æ³¨å…¥éœ€æ±‚ã€‚**<font color="red">Wireä¼šè‡ªåŠ¨ç”Ÿæˆä¾èµ–æ³¨å…¥ä»£ç ï¼Œæé«˜äº†å¼€å‘æ•ˆç‡å’Œä»£ç è´¨é‡ã€‚</font>
- <font color="red">wireåªæ˜¯ç”Ÿæˆä»£ç ï¼Œä¸ä½¿ç”¨reflectåº“ï¼Œæ€§èƒ½æ–¹é¢æ˜¯ä¸ç”¨æ‹…å¿ƒçš„ã€‚</font>å› ä¸ºå®ƒç”Ÿæˆçš„ä»£ç ä¸ä½ è‡ªå·±å†™çš„åŸºæœ¬æ˜¯ä¸€æ ·çš„ã€‚å¦‚æœç”Ÿæˆçš„ä»£ç æœ‰æ€§èƒ½é—®é¢˜ï¼Œè‡ªå·±å†™å¤§æ¦‚ç‡ä¹Ÿä¼šæœ‰
- kitexä¸kratosæ¡†æ¶çš„ä¾èµ–æ³¨å…¥éƒ½æ˜¯ä½¿ç”¨wire, æ›´åŠ é«˜æ•ˆåœ°å¼€å‘å’Œç®¡ç†é¡¹ç›®ä¸­çš„ä¾èµ–å…³ç³»ã€‚æ–¹ä¾¿åœ°ç®¡ç†å’Œæ³¨å…¥ä¾èµ–å…³ç³»ï¼Œå‡å°‘æ‰‹åŠ¨ç¼–å†™å¤§é‡çš„ä¾èµ–æ³¨å…¥ä»£ç çš„å·¥ä½œé‡ã€‚

# dig
## é¢å‘å¯¹è±¡å’Œä¸ºä»€éœ€è¦IOCæ¡†æ¶
{{< innerlink src="posts/tech/go50.md" >}}  
- ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰åº“â€”â€”digã€‚dig æ˜¯ uber å¼€æºçš„åº“, ä¹Ÿæ˜¯iocæ¡†æ¶, go.uber.org/dig
- é€‚ç”¨äºè§£å†³å¾ªç¯ä¾èµ–çš„å¯¹è±¡åˆ›å»ºé—®é¢˜ã€‚åŒæ—¶ä¹Ÿæœ‰åˆ©äºå°†å…³æ³¨ç‚¹åˆ†ç¦»ï¼Œæˆ‘ä»¬ä¸éœ€è¦å°†å„ç§å¯¹è±¡ä¼ æ¥ä¼ å»ï¼Œåªéœ€è¦å°†æ„é€ å‡½æ•°äº¤ç»™digå®¹å™¨ï¼Œç„¶åé€šè¿‡Invokeç›´æ¥ä½¿ç”¨ä¾èµ–å³å¯ï¼Œè¿åˆ¤ç©ºé€»è¾‘éƒ½å¯ä»¥çœç•¥äº†
## å…·ä½“ä½¿ç”¨
{{< innerlink src="posts/tech/go51.md" >}}  
## å®Œæ•´æ¡ˆä¾‹
``` go
type Handler struct {
  Greeting string
  Path     string
}

func (h Handler) ServeHTTP(w http.ResponseWriter, r *http.Request) {
  fmt.Fprintf(w, "%s from %s", h.Greeting, h.Path)
}

func NewHello1Handler() HandlerResult {
  return HandlerResult{
    Handler: Handler{
      Path:     "/hello1",
      Greeting: "welcome",
    },
  }
}

func NewHello2Handler() HandlerResult {
  return HandlerResult{
    Handler: Handler{
      Path:     "/hello2",
      Greeting: "ğŸ˜„",
    },
  }
}

type HandlerResult struct {
  dig.Out

  Handler Handler `group:"server"`
}

type HandlerParams struct {
  dig.In

  Handlers []Handler `group:"server"`
}

func RunServer(params HandlerParams) error {
  mux := http.NewServeMux()
  for _, h := range params.Handlers {
    mux.Handle(h.Path, h)
  }

  server := &http.Server{
    Addr:    ":8080",
    Handler: mux,
  }
  if err := server.ListenAndServe(); err != nil {
    return err
  }

  return nil
}

func main() {
  container := dig.New()
  // åˆ›å»ºäº†ä¸¤ä¸ªå¤„ç†å™¨ï¼Œæ·»åŠ åˆ°serverç»„ä¸­ï¼Œåœ¨RunServerå‡½æ•°ä¸­åˆ›å»º HTTP æœåŠ¡å™¨ï¼Œå°†è¿™äº›å¤„ç†å™¨æ³¨å†Œåˆ°æœåŠ¡å™¨ä¸­ã€‚
  container.Provide(NewHello1Handler)
  container.Provide(NewHello2Handler)

  container.Invoke(RunServer)
}
```

è¿è¡Œç¨‹åºï¼Œåœ¨æµè§ˆå™¨ä¸­è¾“å…¥localhost:8080/hello1å’Œlocalhost:8080/hello2çœ‹çœ‹

# wire
wireæ˜¯ Google å¼€æºçš„ä¸€ä¸ªä¾èµ–æ³¨å…¥å·¥å…·ã€‚<font color="red">å®ƒæ˜¯ä¸€ä¸ªä»£ç ç”Ÿæˆå™¨ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªæ¡†æ¶ã€‚æˆ‘ä»¬åªéœ€è¦åœ¨ä¸€ä¸ªç‰¹æ®Šçš„goæ–‡ä»¶ä¸­å‘Šè¯‰wireç±»å‹ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œå®ƒä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬ç”Ÿæˆä»£ç ï¼Œå¸®åŠ©æˆ‘ä»¬åˆ›å»ºæŒ‡å®šç±»å‹çš„å¯¹è±¡ï¼Œå¹¶ç»„è£…å®ƒçš„ä¾èµ–ã€‚</font>

## å®‰è£…å·¥å…·
- go get github.com/google/wire/cmd/wire
- ä¼šåœ¨$GOPATH/binä¸­ç”Ÿæˆä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºwireï¼Œè¿™å°±æ˜¯ä»£ç ç”Ÿæˆå™¨ã€‚ è‡ªå·±æ˜¯å¦åŠ å…¥ç¯å¢ƒå˜é‡


## ä½¿ç”¨
**å‹‡å£«æ‰“è´¥äº†æ€ªå…½ï¼Œå®Œæˆäº†ä½¿å‘½**
``` go
// æ€ªå…½
type Monster struct {
  Name string
}

func NewMonster() Monster {
  return Monster{Name: "kitty"}
}

// å‹‡å£«
type Player struct {
  Name string
}

func NewPlayer(name string) Player {
  return Player{Name: name}
}

// ä½¿å‘½
type Mission struct {
  Player  Player
  Monster Monster
}

func NewMission(p Player, m Monster) Mission {
  return Mission{p, m}
}

func (m Mission) Start() {
  fmt.Printf("%s defeats %s, world peace!\n", m.Player.Name, m.Monster.Name)
}

// ç®€å•ä¾èµ–ï¼Œå¦‚æœä»¥åå¤æ‚äº†å‘¢
func main() {
  monster := NewMonster()
  player := NewPlayer("dj")
  // æ‰‹åŠ¨åˆ›å»ºæ¯ä¸ªä¾èµ–ï¼Œç„¶åå°†å®ƒä»¬ç»„è£…èµ·æ¥çš„æ–¹å¼å°±ä¼šå˜å¾—å¼‚å¸¸ç¹çï¼Œå¹¶ä¸”å®¹æ˜“å‡ºé”™
  mission := NewMission(player, monster)

  mission.Start()
}

```
1. <font color="red">åˆ›å»ºwire.goæ–‡ä»¶</font>  wire.Build
   - æ¯”å¦‚åˆ›å»ºå¹¶åˆå§‹åŒ–ä¸€ä¸ªMissionå¯¹è±¡: å‡½æ•°çš„è¿”å›å€¼å°±æ˜¯æˆ‘ä»¬éœ€è¦åˆ›å»ºçš„å¯¹è±¡ç±»å‹ï¼Œ<font color="red">wireåªéœ€è¦çŸ¥é“ç±»å‹</font>ï¼Œreturnåè¿”å›ä»€ä¹ˆä¸é‡è¦ã€‚
   - å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬<font color="red">è°ƒç”¨wire.Build()å°†åˆ›å»ºMissionæ‰€ä¾èµ–çš„ç±»å‹çš„æ„é€ å™¨ä¼ è¿›å»</font>
``` go
//+build wireinject

package main
import "github.com/google/wire"

func InitMission(name string) Mission {
  // Missionå¯¹è±¡çš„æ„é€ å™¨ï¼ŒNewMission()æ¥å—ä¸¤ä¸ªå‚æ•°ä¸€ä¸ªMonsterç±»å‹ï¼Œä¸€ä¸ªPlayerç±»å‹ã€‚
  // Monsterç±»å‹å¯¹è±¡éœ€è¦è°ƒç”¨NewMonster()åˆ›å»ºï¼ŒPlayerç±»å‹å¯¹è±¡éœ€è¦è°ƒç”¨NewPlayer()åˆ›å»ºã€‚
  // nameå‚æ•°æ˜¯NewPlayeréœ€è¦çš„
  wire.Build(NewMonster, NewPlayer, NewMission)
  return Mission{}
}
```
2. æ‰§è¡Œwireå‘½ä»¤ï¼Œç”Ÿæˆwire_gen.goæ–‡ä»¶(è°ƒç”¨wireç”Ÿæˆwire_gen.goä¹‹åï¼Œå¦‚æœwire.goæ–‡ä»¶æœ‰ä¿®æ”¹ï¼Œåªéœ€è¦æ‰§è¡Œgo generateå³å¯)
``` go
//go:generate wire
//+build !wireinject

package main
// Injectors from wire.go:

func InitMission(name string) Mission {
  player := NewPlayer(name)
  monster := NewMonster()
  mission := NewMission(player, monster)
  return mission
}
```
- ç„¶å æˆ‘ä»¬å°±èƒ½ç›´æ¥ç”¨äº†
``` go
func main() {
  mission := InitMission("dj")

  mission.Start()
}
```


- <font color="red">wireå·¥å…·åªä¼šå¤„ç†æœ‰wireinjectçš„æ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„wire.goæ–‡ä»¶è¦åŠ ä¸Šè¿™ä¸ªã€‚ç”Ÿæˆçš„wire_gen.goæ˜¯ç»™æˆ‘ä»¬æ¥ä½¿ç”¨çš„ï¼Œwireä¸éœ€è¦å¤„ç†ï¼Œæ•…æœ‰!wireinjectã€‚</font>
  - wire.goå’Œwire_gen.goæ–‡ä»¶å¤´éƒ¨ä½ç½®éƒ½æœ‰ä¸€ä¸ª+buildï¼Œ**ä¸è¿‡ä¸€ä¸ªåé¢æ˜¯wireinjectï¼Œå¦ä¸€ä¸ªæ˜¯!wireinjectã€‚**
- //+build wireinjectä¸package mainè¿™ä¸¤è¡Œä¹‹é—´æ˜¯å¦æœ‰ç©ºè¡Œï¼Œè¿™ä¸ªç©ºè¡Œå¿…é¡»è¦æœ‰
  - <font color="red">+buildå…¶å®æ˜¯ Go è¯­è¨€çš„ä¸€ä¸ªç‰¹æ€§ã€‚</font> ç±»ä¼¼ C/C++ çš„æ¡ä»¶ç¼–è¯‘ï¼Œåœ¨æ‰§è¡Œgo buildæ—¶å¯ä¼ å…¥ä¸€äº›é€‰é¡¹ï¼Œæ ¹æ®è¿™ä¸ªé€‰é¡¹å†³å®šæŸäº›æ–‡ä»¶æ˜¯å¦ç¼–è¯‘ã€‚
## åŸºç¡€æ¦‚å¿µ
- Providerï¼ˆæ„é€ å™¨ï¼‰,åˆ›å»ºå‡½æ•°, æ¯”å¦‚NewPlayer
- Injectorï¼ˆæ³¨å…¥å™¨ï¼‰, æ¯”å¦‚InitMission
- æ¯ä¸ªæ³¨å…¥å™¨å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªå¯¹è±¡çš„åˆ›å»ºå’Œåˆå§‹åŒ–å‡½æ•°ã€‚åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦å‘Šè¯‰wireè¦åˆ›å»ºä»€ä¹ˆç±»å‹çš„å¯¹è±¡ï¼Œè¿™ä¸ªç±»å‹çš„ä¾èµ–

## å‚æ•°
- wireåœ¨ç”Ÿæˆä»£ç æ—¶ï¼Œæ„é€ å™¨éœ€è¦çš„å‚æ•°ï¼ˆæˆ–è€…å«ä¾èµ–ï¼‰ä¼šä»å‚æ•°ä¸­æŸ¥æ‰¾æˆ–é€šè¿‡å…¶å®ƒæ„é€ å™¨ç”Ÿæˆã€‚
- å†³å®šé€‰æ‹©å“ªä¸ªå‚æ•°æˆ–æ„é€ å™¨å®Œå…¨æ ¹æ®ç±»å‹ã€‚**å¦‚æœå‚æ•°æˆ–æ„é€ å™¨ç”Ÿæˆçš„å¯¹è±¡æœ‰ç±»å‹ç›¸åŒçš„æƒ…å†µ, è¿è¡Œwireå·¥å…·æ—¶ä¼šæŠ¥é”™**
  - <font color="red">éœ€è¦ä¸ºä¸åŒç±»å‹åˆ›å»ºä¸åŒçš„å‚æ•°ç»“æ„, ä½¿ç”¨type</font>
  - åœ¨å‚æ•°æ¯”è¾ƒå¤æ‚çš„æ—¶å€™ï¼Œå»ºè®®å°†å‚æ•°æ”¾åœ¨ä¸€ä¸ªç»“æ„ä¸­

``` go
// ä¸ºä¸åŒç±»å‹åˆ›å»ºä¸åŒçš„å‚æ•°ç»“æ„
type PlayerParam string
type MonsterParam string

func NewPlayer(name PlayerParam) Player {
  return Player{Name: string(name)} // æ¯”å¦‚nameå‚æ•°å°±è¢«ä¼ ç»™äº†NewPlayer()
}

func NewMonster(name MonsterParam) Monster {
  return Monster{Name: string(name)}
}

func main() {
  mission := InitMission("dj", "kitty")
  mission.Start()
}

// wire.go æ–‡ä»¶é‡Œæ˜¯è¿™ä¹ˆå®šä¹‰çš„
func InitMission(p PlayerParam, m MonsterParam) Mission {
  wire.Build(NewPlayer, NewMonster, NewMission)
  return Mission{}
}
```

## é”™è¯¯ ï¼ˆæ­£ç¡®å¤„ç†æ„é€ å™¨è¿”å›çš„é”™è¯¯ï¼‰
- wireéµå¾ªfail-fastçš„åŸåˆ™ï¼Œ<font color="red">é”™è¯¯å¿…é¡»è¢«å¤„ç†ã€‚å¦‚æœæˆ‘ä»¬çš„æ³¨å…¥å™¨ä¸è¿”å›é”™è¯¯ï¼Œä½†æ„é€ å™¨è¿”å›é”™è¯¯ï¼Œwireå·¥å…·ä¼šæŠ¥é”™</font>

``` go
// wire.go æ­£ç¡®å¤„ç†æ„é€ å™¨è¿”å›çš„é”™è¯¯
func InitMission(name string) (Mission, error) {
  wire.Build(NewMonster, NewPlayer, NewMission)
  return Mission{}, nil
}

// æ³¨å…¥å™¨çš„è¿”å›å€¼æœ‰æ—¶å€™ä¹Ÿéœ€è¦è€ƒè™‘é”™è¯¯
// ç”Ÿæˆçš„ä»£ç ï¼Œä¼šå°†NewPlayer()è¿”å›çš„é”™è¯¯ï¼Œä½œä¸ºInitMission()çš„è¿”å›å€¼
func InitMission(name string) (Mission, error) {
  player, err := NewPlayer(name)
  if err != nil {
    return Mission{}, err 
  }
  monster := NewMonster()
  mission := NewMission(player, monster)
  return mission, nil
}
```

## é«˜çº§ç‰¹æ€§

1. wireæä¾›äº†ä¸€ä¸ª<font color="red">ProviderSetï¼ˆæ„é€ å™¨é›†åˆï¼‰ï¼Œå¯ä»¥å°†å¤šä¸ªæ„é€ å™¨æ‰“åŒ…æˆä¸€ä¸ªé›†åˆ</font>ï¼Œåç»­åªéœ€è¦ä½¿ç”¨è¿™ä¸ªé›†åˆå³å¯
  - ä¸¤æ¬¡è°ƒç”¨wire.Build()éƒ½éœ€è¦ä¼ å…¥NewMonsterå’ŒNewPlayerã€‚ä¸¤ä¸ªè¿˜å¥½ï¼Œå¦‚æœå¾ˆå¤šçš„è¯å†™èµ·æ¥å°±éº»çƒ¦äº†ï¼Œè€Œä¸”ä¿®æ”¹ä¹Ÿä¸å®¹æ˜“
  - å¦‚æœè¦æ·»åŠ æˆ–åˆ é™¤æŸä¸ªæ„é€ å™¨ï¼Œç›´æ¥ä¿®æ”¹setçš„å®šä¹‰å¤„å³å¯
``` go
type EndingA struct {
  Player  Player
  Monster Monster
}
func NewEndingA(p Player, m Monster) EndingA {
  return EndingA{p, m}
}
func (p EndingA) Appear() {
  fmt.Printf("%s defeats %s, world peace!\n", p.Player.Name, p.Monster.Name)
}
// xxx
// EndingBä¸€æ ·

// è¦æ·»åŠ æˆ–åˆ é™¤æŸä¸ªæ„é€ å™¨ï¼Œç›´æ¥ä¿®æ”¹setçš„å®šä¹‰å¤„å³å¯
var monsterPlayerSet = wire.NewSet(NewMonster, NewPlayer)

func InitEndingA(name string) EndingA {
  wire.Build(monsterPlayerSet, NewEndingA)
  return EndingA{}
}
```

2. ç»“æ„æ„é€ å™¨åˆ›å»ºæŸä¸ªç±»å‹çš„ç»“æ„ï¼Œç„¶åç”¨å‚æ•°æˆ–è°ƒç”¨å…¶å®ƒæ„é€ å™¨å¡«å……å®ƒçš„å­—æ®µã€‚
   - ç»“æ„æ„é€ å™¨ä½¿ç”¨wire.Structæ³¨å…¥ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å›ºå®šä¸ºnew(ç»“æ„å)ï¼Œåé¢å¯æ¥ä»»æ„å¤šä¸ªå‚æ•°ï¼Œè¡¨ç¤ºéœ€è¦ä¸ºè¯¥ç»“æ„çš„å“ªäº›å­—æ®µæ³¨å…¥å€¼
   - ä½¿ç”¨é€šé…ç¬¦*è¡¨ç¤ºæ³¨å…¥æ‰€æœ‰å­—æ®µ

æ¯”å¦‚ï¼šå­—æ®µåªæœ‰Playerå’ŒMonsterï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦æ˜¾å¼ä¸ºå®ƒä»¬æä¾›æ„é€ å™¨, ä»¥ç›´æ¥ä½¿ç”¨wireæä¾›çš„ç»“æ„æ„é€ å™¨
``` go

var monsterPlayerSet = wire.NewSet(NewMonster, NewPlayer) // é›†åˆ
// è¿™é‡Œæ˜¯éœ€è¦
// var endingASet = wire.NewSet(monsterPlayerSet, wire.Struct(new(EndingA), "*"))
var endingASet = wire.NewSet(monsterPlayerSet, wire.Struct(new(EndingA), "Player", "Monster"))

func InitEndingA(name string) EndingA {
  wire.Build(endingASet)
  return EndingA{}
}
// ç”Ÿæˆçš„ä»£ç 
func InitEndingA(name string) EndingA {
  player := NewPlayer(name)
  monster := NewMonster()
  endingA := EndingA{
    Player:  player,
    Monster: monster,
  }
  return endingA
}
```

3. wire.Valueç»‘å®šå€¼ï¼Œä½¿ç”¨wire.InterfaceValueç»‘å®šæ¥å£
   - è¿™ä¸ªå€¼æ¯æ¬¡ä½¿ç”¨æ—¶éƒ½ä¼šæ‹·è´
``` go
var kitty = Monster{Name: "kitty"}

func InitEndingA(name string) EndingA {
  wire.Build(NewPlayer, wire.Value(kitty), NewEndingA)
  return EndingA{}
}

// ç”Ÿæˆçš„ä»£ç 
// wire_gen.go
func InitEndingA(name string) EndingA {
  player := NewPlayer(name)
  monster := _wireMonsterValue
  endingA := NewEndingA(player, monster)
  return endingA
}

var (
  _wireMonsterValue = kitty
)
``` 

4. ç»“æ„å­—æ®µä½œä¸ºæ„é€ å™¨ wire.FieldsOf
   - ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºnew(ç»“æ„å)ï¼Œåé¢è·Ÿå¤šä¸ªå‚æ•°è¡¨ç¤ºå°†å“ªäº›å­—æ®µä½œä¸ºæ„é€ å™¨ï¼Œ*è¡¨ç¤ºå…¨éƒ¨ã€‚

``` go 
func NewMission() Mission {
  p := Player{Name: "dj"}
  m := Monster{Name: "kitty"}

  return Mission{p, m}
}

// wire.go
func InitPlayer() Player {
    // è·å¾—Monsterå’ŒPlayerç±»å‹çš„å¯¹è±¡
  wire.Build(NewMission, wire.FieldsOf(new(Mission), "Player"))
}
```

5. æ„é€ å™¨å¯ä»¥æä¾›ä¸€ä¸ªæ¸…ç†å‡½æ•°ï¼Œå¦‚æœåç»­çš„æ„é€ å™¨è¿”å›å¤±è´¥ï¼Œå‰é¢æ„é€ å™¨è¿”å›çš„æ¸…ç†å‡½æ•°éƒ½ä¼šè°ƒç”¨
``` go 
func NewPlayer(name string) (Player, func(), error) {
  cleanup := func() {
    fmt.Println("cleanup!")
  }
  if time.Now().Unix()%2 == 0 {
    return Player{}, cleanup, errors.New("player dead")
  }
  return Player{Name: name}, cleanup, nil
}

func main() {
  mission, cleanup, err := InitMission("dj")
  if err != nil {
    log.Fatal(err)
  }

  mission.Start()
  cleanup()
}

// wire.go
func InitMission(name string) (Mission, func(), error) {
  wire.Build(NewMonster, NewPlayer, NewMission)
  return Mission{}, nil, nil
}
```